(function(a){function b(b,c){a(window).scroll(function(e){if(a(window).scrollTop()!=b.oldScrollTop){b.percents=new Array;topWindow=a(window).scrollTop()+60;pageHeight=a(document).height();windowHeight=a(window).height();footerWindow=topWindow+windowHeight;a.each(b.blocks,function(a,c){percentBlock=0;topBlock=c[0].offset().top;heightBlock=c[0].height();footerBlock=topBlock+heightBlock;if(topWindow<=topBlock&&footerWindow>=topBlock&&footerWindow<=footerBlock){inside=footerWindow-topBlock;percentBlock=inside/heightBlock*100}else if(footerWindow>=footerBlock&&topWindow>=topBlock&&topWindow<=footerBlock){outside=topWindow-topBlock;inside=heightBlock-outside;percentBlock=inside/heightBlock*100}else if(topWindow>=topBlock&&topWindow<=footerBlock&&footerWindow>=topBlock&&footerWindow<=footerBlock){inside=windowHeight;percentBlock=inside/heightBlock*100}else if(topWindow<=topBlock&&footerWindow>=footerBlock){percentBlock=100}b.percents.push([c[1],percentBlock])});d(b,c);if(b.options.debug)f(b)}})}function c(c,d){a(d).on("click",d.find(c.options.elemActivate+" a"),function(f){var g=f;g.preventDefault();if(c.options.scroll.active)a(window).unbind("scroll");a(document).scrollTo("#"+f.target.href.split("#")[1],c.options.scroll.duration,{axis:c.options.scroll.axis,offset:c.options.scroll.offset,onAfter:function(){c.oldScrollTop=a(window).scrollTop();if(c.options.scroll.active)b(c,d);var f=g.srcElement||g.target;d.find(c.options.elemActivate).removeClass(c.options.activeClass);e(a(f).parents(c.options.elemActivate),c);if(typeof c.options.scroll.afterSmoothClick=="function"){c.options.scroll.afterSmoothClick(f.href.split("#")[1])}else alert("bad callback afterSmoothClick")}});return false})}function d(b,c){c.find(b.options.elemActivate).removeClass(b.options.activeClass);maxPercent=0;selector="";if(a(window).scrollTop()==0)selector=b.percents[0][0];else if(a(window).scrollTop()+a(window).height()==a(document).height())selector=b.percents[b.percents.length-1][0];else{a.each(b.percents,function(a,b){if(b[1]>maxPercent){maxPercent=b[1];selector=b[0]}})}e(selector.parents(b.options.elemActivate),b)}function e(a,b){a.addClass(b.options.activeClass)}function f(b){a.each(b.percents,function(a,b){console.log(b[0].selector+" : "+b[1])})}a.fancyScroll=function(d,e){context=this;context.options={};context.percents=new Array;context.blocks=[];context.oldScrollTop=0;d.data("fancyScroll",this);this.init=function(d,e){this.options=a.extend(true,a.fancyScroll.defaultOptions,e);context.oldScrollTop=a(window).scrollTop();a.each(d.find(context.options.elemActivate+" a"),function(b,c){context.blocks.push([a(a(c).attr("href")),a(c)])});if(this.options.spy.active){b(this,d)}if(this.options.scroll.active)c(this,d)};this.init(d,e)};a.fn.fancyScroll=function(b){return this.each(function(){new a.fancyScroll(a(this),b)})};a.fancyScroll.defaultOptions={activeClass:"active",elemActivate:"li",debug:false,scroll:{active:true,offset:0,axis:"y",duration:1e3,afterSmoothClick:function(){}},spy:{active:true}}})(jQuery)